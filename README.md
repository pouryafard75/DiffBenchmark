Table of Contents
=================

   * [General info](#general-info)
   * [How to build DiffBenchmark](#how-to-build-diffbenchmark)
   * [Usage guidelines](#usage-guidelines)
      * [With a locally cloned git repository](#with-a-locally-cloned-git-repository)
      * [With two directories containing Java source code](#with-two-directories-containing-java-source-code)
      * [With all information fetched directly from GitHub](#with-all-information-fetched-directly-from-github)

# General info
DiffBenchmark is a visualization tool for the AST diff generated by [RefactoringMiner](https://github.com/tsantalis/RefactoringMiner).
It is based on the Diff viewers provided by [GumTreeDiff](https://github.com/GumTreeDiff/gumtree).

# How to build DiffBenchmark

First, clone the [RefactoringMiner](https://github.com/tsantalis/RefactoringMiner.git) repository.

Next, edit file `build.gradle` in the root folder of the RefactoringMiner repository, and change the version to
```
version = "2.3.2-SNAPSHOT"
```

Run command `gradle publishToMavenLocal` in the root folder of the RefactoringMiner repository.
This will create the `com.github.tsantalis:refactoring-miner:2.3.2-SNAPSHOT` dependency to your local Maven repository.

# Usage guidelines

You simply need to execute [Run.java](https://github.com/pouryafard75/DiffBenchmark/blob/master/src/main/java/rm/Run.java)

There are 3 different ways you can execute DiffBenchmark:

## With a locally cloned git repository
```java
String url = "https://github.com/JetBrains/intellij-community/commit/7ed3f273ab0caf0337c22f0b721d51829bb0c877";
String repo = URLHelper.getRepo(url);
String commit = URLHelper.getCommit(url);

GitService gitService = new GitServiceImpl();
String pathToClonedRepository = "/tmp/JetBrains/intellij-community";
Repository repository = gitService.cloneIfNotExists(pathToClonedRepository, repo);

Set<ASTDiff> astDiffs = new GitHistoryRefactoringMinerImpl().diffAtCommit(repository, commit);
new WebDiff(astDiffs).run();
```
## With two directories containing Java source code
```java
String folder1 = "/tmp/v1/";
String folder2 = "/tmp/v2/";

Set<ASTDiff> astDiffs = new GitHistoryRefactoringMinerImpl().diffAtDirectories(Path.of(folder1),Path.of(folder2));
new WebDiff(astDiffs).run();
```

## With all information fetched directly from GitHub
To use the following API, please provide a valid OAuth token in the `github-oauth.properties` file.
You can generate an OAuth token in GitHub `Settings` -> `Developer settings` -> `Personal access tokens`.
```java
String url = "https://github.com/JetBrains/intellij-community/commit/7ed3f273ab0caf0337c22f0b721d51829bb0c877";
String repo = URLHelper.getRepo(url);
String commit = URLHelper.getCommit(url);

Set<ASTDiff> astDiffs = new GitHistoryRefactoringMinerImpl().diffAtCommit(repo, commit, 1000);
new WebDiff(astDiffs).run();
```

