This repository contains all the source-code and experiments related to the following paper:

Pouria Alikhanifard and Nikolaos Tsantalis, "[A Novel Refactoring and Semantic Aware Abstract Syntax Tree Differencing Tool and a Benchmark for Evaluating the Accuracy of Diff Tools](https://arxiv.org/pdf/2403.05939)," *ACM Transactions on Software Engineering and Methodology*, 2024.

The oracle files are located in the [oracle](https://github.com/pouryafard75/DiffBenchmark/tree/master/oracle) folder and the **Experiment Results** are located in the [out](https://github.com/pouryafard75/DiffBenchmark/tree/master/out) folder.

Please check the [Wiki](https://github.com/pouryafard75/DiffBenchmark/wiki) for the detailed explanation. You can find the list of all supported ASTDiffTools [here](
https://github.com/pouryafard75/DiffBenchmark/wiki/Supported-ASTDiff-Tools).

Table of Contents
=================
   * [General info](#general-info)
   * [How to build DiffBenchmark](#how-to-build-diffbenchmark)
   * [Usage guidelines](#usage-guidelines)
      * [With a locally cloned git repository](#with-a-locally-cloned-git-repository)
      * [With two directories containing Java source code](#with-two-directories-containing-java-source-code)
      * [With all information fetched directly from GitHub](#with-all-information-fetched-directly-from-github)

# General info
DiffBenchmark is a visualization tool for the AST diff generated by [RefactoringMiner](https://github.com/tsantalis/RefactoringMiner).
It is based on the Diff viewers provided by [GumTreeDiff](https://github.com/GumTreeDiff/gumtree).

# How to build DiffBenchmark

First, clone the [RefactoringMiner](https://github.com/tsantalis/RefactoringMiner.git) repository.

Then, you have to update the `REFACTORING_MINER_PATH` in **one** of the following ways:

Update the field `REFACTORING_MINER_PATH` in the `benchmark.utils.Configuration.ConfigurationFactory` class to the RefactoringMiner cloned repository path in your hard drive **or** you can have it as env variable _REFACTORING_MINER_PATH_

Import DiffBenchmark as a gradle project in your IDE, or run `./gradlew jar` to build.

# Usage guidelines

There are 3 different ways you can execute DiffBenchmark:

## With a locally cloned git repository

Execute [RunWithLocallyClonedRepository.java](https://github.com/pouryafard75/DiffBenchmark/blob/master/src/main/java/gui/RunWithLocallyClonedRepository.java)
```java
String url = "https://github.com/JetBrains/intellij-community/commit/7ed3f273ab0caf0337c22f0b721d51829bb0c877";
String repo = URLHelper.getRepo(url);
String commit = URLHelper.getCommit(url);

GitService gitService = new GitServiceImpl();
String projectName = repo.substring(repo.lastIndexOf("/") + 1, repo.length() - 4);
String pathToClonedRepository = "tmp/" + projectName;
Repository repository = gitService.cloneIfNotExists(pathToClonedRepository, repo);

ProjectASTDiff projectASTDiff = new GitHistoryRefactoringMinerImpl().diffAtCommit(repository, commit);
new WebDiff(projectASTDiff).run();
```
## With two directories containing Java source code

Execute [RunWithTwoDirectories.java](https://github.com/pouryafard75/DiffBenchmark/blob/master/src/main/java/gui/RunWithTwoDirectories.java)
```java
final String projectRoot = System.getProperty("user.dir");
String folder1 = projectRoot + "/tmp/v1/";
String folder2 = projectRoot + "/tmp/v2/";

ProjectASTDiff projectASTDiff = new GitHistoryRefactoringMinerImpl().diffAtDirectories(Path.of(folder1), Path.of(folder2));
new WebDiff(projectASTDiff).run();
```

## With all information fetched directly from GitHub
To use the following API, please provide a valid OAuth token in the `github-oauth.properties` file.
You can generate an OAuth token in GitHub `Settings` -> `Developer settings` -> `Personal access tokens`.

Execute [RunWithGitHubAPI.java](https://github.com/pouryafard75/DiffBenchmark/blob/master/src/main/java/gui/RunWithGitHubAPI.java)
```java
String url = "https://github.com/JetBrains/intellij-community/commit/7ed3f273ab0caf0337c22f0b721d51829bb0c877";
String repo = URLHelper.getRepo(url);
String commit = URLHelper.getCommit(url);

ProjectASTDiff projectASTDiff = new GitHistoryRefactoringMinerImpl().diffAtCommit(repo, commit, 1000);
new WebDiff(projectASTDiff).run();
```

